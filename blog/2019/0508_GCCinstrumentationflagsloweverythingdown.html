<h1>Blog title<a name="blogtitle"></a></h1>
<h1>Menu<a name="menu"></a></h1>
<ul>
<li><a href="/">Home</a></li>
<li><a href="/blog/index.html">Blog</a></li>
<li><a href="/blog/history.html">History</a></li>
</ul>
<h1>GCC instrumentation flag: slow everything down!<a name="gccinstrumentationflagsloweverythingdown"></a></h1>
<p>Here's a nice gcc tip if you think your code is running too fast: instrument everything! (Ok, it may also work if you need to create a profile of your application but for some reason Valgrind isn't your thing).</p>
<p>Compile with</p>
<pre lang="c++" style="display: inline-block; border: 1px solid red;">g++ foo.cpp -ggdb3 -finstrument-functions
</pre>
<p>You can get a list of symbols with nm and c++filt, or you can implement your own elf reader too for extra fun.</p>
<pre lang="c++" style="display: inline-block; border: 1px solid red;">extern &quot;C&quot; {
    bool g__cyg_profile_enabled = false;
    stack g__cyg_times;
    void <strong>cyg_profile_func_enter(void <em>, void </em>) __attribute</strong>((no_instrument_function));
    void <strong>cyg_profile_func_exit(void <em>, void </em>) __attribute</strong>((no_instrument_function));
    void cyg_profile_enable() <strong>attribute</strong>((no_instrument_function));
    void cyg_profile_disable() <strong>attribute</strong>((no_instrument_function));
    void __cyg_profile_func_enter(void <em>this_fn, void </em>call_site) {
        if (not g__cyg_profile_enabled) return;
        cout &amp;lt;&amp;lt; this_fn &amp;lt;&amp;lt; endl;
    }
    void __cyg_profile_func_exit(void <em>this_fn, void </em>call_site) {
        if (not g__cyg_profile_enabled) return;
        cout &amp;lt;&amp;lt; this_fn &amp;lt;&amp;lt; endl;
    }
    void cyg_profile_enable() {
        g__cyg_profile_enabled = true;
    }
    void cyg_profile_disable() {
        g__cyg_profile_enabled = false;
    }
}
int a() {
    return 42;
}
int b() {
    return a();
}
int c() {
    int x = b();
    int y = a();
    return x+y;
}
int d() {
    return c() + b();
}
int main() {
    cyg_profile_enable();
    cout &lt;&lt; d() &lt;&lt; endl;
    cyg_profile_disable();
    return 0;
}
</pre>
<hr />
<p>Post by Nico Brailovsky @ 2019-05-08 -
    <a href="/blog/2019/0508_GCCinstrumentationflagsloweverythingdown.html">Permalink</a> -
    <a href="https://github.com/nicolasbrailo/nicolasbrailo.github.io/issues/new?title=Comment@/blog_md/2019/0508_GCCinstrumentationflagsloweverythingdown.md&amp;body=I%20have%20a%20comment!">Leave a comment</a></p>